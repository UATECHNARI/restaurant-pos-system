# üóëÔ∏è –í–ò–î–ê–õ–ò–¢–ò –°–¢–Ü–õ: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ foreign key

## ‚ùå –ü–æ–º–∏–ª–∫–∞:

```
ERROR 1451: Cannot delete or update a parent row: a foreign key constraint fails
(bar_kitchen_pos.orders, CONSTRAINT orders_ibfk_1 FOREIGN KEY (table_number) 
REFERENCES tables (number) ON UPDATE CASCADE)
```

**–ü—Ä–∏—á–∏–Ω–∞:** Foreign key constraint –º—ñ–∂ `orders` —Ç–∞ `tables` –Ω–µ –º–∞—î `ON DELETE`, —Ç–æ–º—É MySQL –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–¥–∞–ª—è—Ç–∏ —Å—Ç—ñ–ª, —è–∫—â–æ —î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –Ω–∏–º.

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è (2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏):

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ä–∞–∑–æ–º –∑—ñ —Å—Ç–æ–ª–æ–º (CASCADE) ‚ö†Ô∏è

**–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è**, —è–∫—â–æ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Å—Ç–æ–ª—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –π–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

#### –ö—Ä–æ–∫ 1: –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç:

```powershell
cd D:\Work\Pizza\backend
Get-Content fix-table-delete-constraint.sql | mysql -u root -p bar_kitchen_pos
```

#### –ö—Ä–æ–∫ 2: –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª—è—Ç–∏ —Å—Ç—ñ–ª:

```sql
USE bar_kitchen_pos;

-- –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç—ñ–ª (–≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
DELETE FROM tables WHERE id = 2;
```

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ NULL (SET NULL) üíæ

**–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è**, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–∞–≤—ñ—Ç—å –ø—ñ—Å–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–æ–ª—É.

#### –í–∏–∫–æ–Ω–∞—Ç–∏ SQL –≤—Ä—É—á–Ω—É:

```sql
USE bar_kitchen_pos;

-- 1. –ó–º—ñ–Ω–∏—Ç–∏ table_number –Ω–∞ NULLABLE
ALTER TABLE orders MODIFY COLUMN table_number INT NULL;

-- 2. –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ä–∏–π foreign key
ALTER TABLE orders DROP FOREIGN KEY orders_ibfk_1;

-- 3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π foreign key –∑ ON DELETE SET NULL
ALTER TABLE orders 
ADD CONSTRAINT fk_orders_table 
FOREIGN KEY (table_number) 
REFERENCES tables(number) 
ON UPDATE CASCADE 
ON DELETE SET NULL;

-- 4. –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª—è—Ç–∏ —Å—Ç—ñ–ª
DELETE FROM tables WHERE id = 2;
-- table_number —É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö —Å—Ç–∞–Ω–µ NULL
```

---

## üîç –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ foreign key:

```sql
USE bar_kitchen_pos;

SELECT 
    CONSTRAINT_NAME,
    TABLE_NAME,
    COLUMN_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME,
    UPDATE_RULE,
    DELETE_RULE
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE k
JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS r
    ON k.CONSTRAINT_NAME = r.CONSTRAINT_NAME
WHERE k.TABLE_SCHEMA = 'bar_kitchen_pos'
    AND k.TABLE_NAME = 'orders'
    AND k.COLUMN_NAME = 'table_number';
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- `DELETE_RULE` = `CASCADE` (–≤–∞—Ä—ñ–∞–Ω—Ç 1) –∞–±–æ `SET NULL` (–≤–∞—Ä—ñ–∞–Ω—Ç 2)

---

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—Ä—É—á–Ω—É

–Ø–∫—â–æ –Ω–µ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ foreign key constraint, –º–æ–∂–Ω–∞ —Å–ø–æ—á–∞—Ç–∫—É –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:

```sql
USE bar_kitchen_pos;

-- 1. –ó–Ω–∞–π—Ç–∏ –Ω–æ–º–µ—Ä —Å—Ç–æ–ª—É
SELECT number FROM tables WHERE id = 2;

-- 2. –í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Å—Ç–æ–ª—É
DELETE FROM orders WHERE table_number = (SELECT number FROM tables WHERE id = 2);

-- 3. –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç—ñ–ª
DELETE FROM tables WHERE id = 2;
```

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –í–∞—Ä—ñ–∞–Ω—Ç 1 (CASCADE)** - –æ–Ω–æ–≤–∏—Ç–∏ foreign key constraint, —â–æ–± –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ —Å—Ç–æ–ª—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è–ª–∏—Å—å –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è. –¶–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —Ç–∞ –Ω–∞–π–±–µ–∑–ø–µ—á–Ω—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏.

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `fix-table-delete-constraint.sql` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è foreign key constraint.


