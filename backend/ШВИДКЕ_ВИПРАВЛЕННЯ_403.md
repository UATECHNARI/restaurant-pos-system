# üö® –®–í–ò–î–ö–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –ü–û–ú–ò–õ–ö–ò 403

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:

```
Error: You have an error in your SQL syntax
INSERT INTO products (client_id, name, ...) VALUES (, 'espresso', ...)
```

**–ü—Ä–∏—á–∏–Ω–∞:** `client_id` —î `null` –∞–±–æ `undefined` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –º–∞—î `client_id` –≤ –ë–î.

---

## ‚úÖ –®–í–ò–î–ö–ï –†–Ü–®–ï–ù–ù–Ø:

### –ö—Ä–æ–∫ 1: –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç (—è–∫—â–æ —â–µ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ)

```powershell
cd D:\Work\Pizza\backend
mysql -u root -p < add-multi-tenancy.sql
```

### –ö—Ä–æ–∫ 2: –ú—ñ–≥—Ä—É–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

```powershell
npm run migrate:users
```

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend

```powershell
# –ó—É–ø–∏–Ω–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –ø—Ä–æ—Ü–µ—Å (Ctrl+C)
npm run dev
```

### –ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å

1. –í–∏–π–¥—ñ—Ç—å –∑ —Å–∏—Å—Ç–µ–º–∏
2. –£–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É
3. –°–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä

---

## üîç –ü–ï–†–ï–í–Ü–†–ö–ê:

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î client_id –≤ –ë–î:

```sql
-- –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ MySQL
mysql -u root -p

-- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö
USE bar_kitchen_pos;

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
SELECT id, email, role, client_id FROM users;

-- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤
SELECT * FROM clients;
```

**–Ø–∫—â–æ `client_id` = NULL** - –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é.

---

## üìã –Ø–ö–©–û –ú–Ü–ì–†–ê–¶–Ü–Ø –ù–ï –î–û–ü–û–ú–û–ì–õ–ê:

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞ –≤—Ä—É—á–Ω—É

```sql
-- 1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞
INSERT INTO clients (name, email, status) 
VALUES ('–í–∞—à —Ä–µ—Å—Ç–æ—Ä–∞–Ω', 'admin@pizza.com', 'active');

-- 2. –û—Ç—Ä–∏–º–∞—Ç–∏ ID –∫–ª—ñ—î–Ω—Ç–∞
SELECT id FROM clients WHERE email = 'admin@pizza.com';

-- 3. –û–Ω–æ–≤–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∑–∞–º—ñ–Ω—ñ—Ç—å CLIENT_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID)
UPDATE users SET client_id = CLIENT_ID WHERE email = 'admin@pizza.com';

-- 4. –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
UPDATE users SET client_id = CLIENT_ID WHERE role IN ('kitchen', 'bar', 'cashier');
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏ backend

–ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É backend, —Å–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä —ñ –ø–æ–¥–∏–≤—ñ—Ç—å—Å—è –ª–æ–≥–∏:

```
üîç getClientId: Loading client_id from DB for user_id = X
üìã getClientId: User found, client_id = NULL
‚ö†Ô∏è  getClientId: User exists but client_id is NULL
```

–Ø–∫—â–æ –±–∞—á–∏—Ç–µ `client_id = NULL` - –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é.

---

## ‚úÖ –ü–Ü–°–õ–Ø –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:

1. ‚úÖ SQL —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω–∞–Ω–æ
2. ‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞
3. ‚úÖ Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ
4. ‚úÖ –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏–ª–∏—Å—å
5. ‚úÖ –¢–æ–≤–∞—Ä–∏ —Ç–∞ —Å—Ç–æ–ª–∏ –¥–æ–¥–∞—é—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫

---

## üí° –ü–†–ò–ú–Ü–¢–ö–ê:

–Ø–∫—â–æ –≤–∏ —â–æ–π–Ω–æ –¥–æ–¥–∞–ª–∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω—ñ—Å—Ç—å, –ø–æ—Ç—Ä—ñ–±–Ω–æ:
1. –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç `add-multi-tenancy.sql`
2. –í–∏–∫–æ–Ω–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—é `npm run migrate:users`
3. –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ JWT —Ç–æ–∫–µ–Ω—É –∑ `client_id`

–ë–µ–∑ —Ü—å–æ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–Ω–∞—Ç–∏–º–µ, –¥–æ —è–∫–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –Ω–∞–ª–µ–∂–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á.


