# üîß –í–ò–ü–†–ê–í–ò–¢–ò: –î–æ–¥–∞—Ç–∏ client_id –¥–æ tables —Ç–∞ orders (–ø–æ–∫—Ä–æ–∫–æ–≤–æ)

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∏:

1. **–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ foreign key –¥–æ products:**
   ```
   ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails
   ```
   **–ü—Ä–∏—á–∏–Ω–∞:** –í `products` —î –∑–∞–ø–∏—Å–∏ –∑ `client_id`, —è–∫—ñ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —ñ—Å–Ω—É—é—á–∏–º `clients`.

2. **–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ tables:**
   ```
   ERROR 1054 (42S22): Unknown column 'client_id' in 'where clause'
   ```
   **–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–ª–æ–Ω–∫–∞ `client_id` —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞ –¥–æ —Ç–∞–±–ª–∏—Ü—ñ `tables`.

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è (–ø–æ–∫—Ä–æ–∫–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç):

### –í–∏–∫–æ–Ω–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç `fix-tables-orders-step-by-step.sql`:

```powershell
cd D:\Work\Pizza\backend
Get-Content fix-tables-orders-step-by-step.sql | mysql -u root -p bar_kitchen_pos
```

---

## üìã –©–æ —Ä–æ–±–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:

### –ö—Ä–æ–∫ 1-2: –î–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏ `client_id` (—è–∫ NULL)
- –î–æ–¥–∞—î `client_id` –¥–æ `tables` —Ç–∞ `orders` —è–∫ `NULL` (–±–µ–∑ foreign key)

### –ö—Ä–æ–∫ 3-4: –û–Ω–æ–≤–∏—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ
- –ü—Ä–∏–∑–Ω–∞—á–∞—î –≤—Å—ñ–º –∑–∞–ø–∏—Å–∞–º `client_id = 1` (–ø–µ—Ä—à–∏–π –∫–ª—ñ—î–Ω—Ç)

### –ö—Ä–æ–∫ 5: –û–Ω–æ–≤–∏—Ç–∏ `order_items`
- –î–æ–¥–∞—î `client_id` –¥–æ `order_items` —ñ –æ–Ω–æ–≤–ª—é—î —á–µ—Ä–µ–∑ JOIN –∑ `orders`

### –ö—Ä–æ–∫ 6: –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `products`
- –û–Ω–æ–≤–ª—é—î –≤—Å—ñ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ `client_id` –≤ `products` –Ω–∞ –≤–∞–ª—ñ–¥–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è (1)

### –ö—Ä–æ–∫ 7: –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞ NOT NULL
- –ó–º—ñ–Ω—é—î `client_id` –∑ `NULL` –Ω–∞ `NOT NULL` –¥–ª—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å

### –ö—Ä–æ–∫ 8: –î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏
- –î–æ–¥–∞—î —ñ–Ω–¥–µ–∫—Å–∏ `idx_client_id` –¥–æ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å

### –ö—Ä–æ–∫ 9: –î–æ–¥–∞—Ç–∏ foreign keys
- –î–æ–¥–∞—î foreign key constraints (—Ç–µ–ø–µ—Ä –±–µ–∑ –ø–æ–º–∏–ª–æ–∫, –±–æ –≤—Å—ñ –¥–∞–Ω—ñ –≤–∞–ª—ñ–¥–Ω—ñ)

---

## üîç –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```sql
USE bar_kitchen_pos;

DESCRIBE tables;
DESCRIBE orders;
DESCRIBE order_items;
DESCRIBE products;
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö —î –∫–æ–ª–æ–Ω–∫–∞ `client_id INT NOT NULL`
- –£ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö —î —ñ–Ω–¥–µ–∫—Å `idx_client_id`
- –£ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö —î foreign key –¥–æ `clients(id)`

---

## üöÄ –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è SQL:

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend:

```powershell
cd D:\Work\Pizza\backend
npm run dev
```

### 2. –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å:

1. –í–∏–π—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–∏
2. –ó–∞–π—Ç–∏ –∑–Ω–æ–≤—É
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –ø—Ä–∞—Ü—é—î

---

## ‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ `GET /api/tables` - –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ `GET /api/orders` - –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ `GET /api/products` - –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –í—Å—ñ –∑–∞–ø–∏—Ç–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å `200 OK`

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `fix-tables-orders-step-by-step.sql` - –ø–æ–∫—Ä–æ–∫–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è `client_id`.


