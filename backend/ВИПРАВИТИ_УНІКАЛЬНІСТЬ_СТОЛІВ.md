# üîß –í–ò–ü–†–ê–í–ò–¢–ò: –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å —Å—Ç–æ–ª—ñ–≤ –ø–æ client_id

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:

–ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ —Å—Ç–æ–ª—É —Å–∏—Å—Ç–µ–º–∞ –∫–∞–∂–µ, —â–æ —Å—Ç—ñ–ª –∑ —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –≤–∂–µ —ñ—Å–Ω—É—î, –∞–ª–µ —Ü–µ–π —Å—Ç—ñ–ª –Ω–∞–ª–µ–∂–∏—Ç—å —ñ–Ω—à–æ–º—É `client_id`.

**–ü—Ä–∏—á–∏–Ω–∞:** –í –±–∞–∑—ñ –¥–∞–Ω–∏—Ö —î —Å—Ç–∞—Ä–∏–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å —Ç—ñ–ª—å–∫–∏ –Ω–∞ `number` –±–µ–∑ `client_id`, —Ç–æ–º—É MySQL –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ —Å—Ç—ñ–ª –∑ –Ω–æ–º–µ—Ä–æ–º, —è–∫–∏–π –≤–∂–µ —ñ—Å–Ω—É—î –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞.

---

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è:

### –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç:

```powershell
cd D:\Work\Pizza\backend
Get-Content fix-unique-index-tables.sql | mysql -u root -p bar_kitchen_pos
```

---

## üìã –©–æ —Ä–æ–±–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:

### –ö—Ä–æ–∫ 1: –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ `number`
- –ü–æ–∫–∞–∑—É—î –≤—Å—ñ —ñ–Ω–¥–µ–∫—Å–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –∫–æ–ª–æ–Ω–∫–æ—é `number`

### –ö—Ä–æ–∫ 2: –í–∏–¥–∞–ª—è—î —Å—Ç–∞—Ä—ñ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
- –í–∏–¥–∞–ª—è—î —Å—Ç–∞—Ä–∏–π `UNIQUE INDEX number` (—Ç—ñ–ª—å–∫–∏ –Ω–∞ `number`)
- –í–∏–¥–∞–ª—è—î `UNIQUE INDEX idx_number` (—è–∫—â–æ –≤—ñ–Ω —Ç—ñ–ª—å–∫–∏ –Ω–∞ `number`)

### –ö—Ä–æ–∫ 3-4: –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
- –°—Ç–≤–æ—Ä—é—î `UNIQUE INDEX idx_number_client (number, client_id)`
- –¢–µ–ø–µ—Ä –∫–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –º–∞—Ç–∏ —Å–≤–æ—ó —Å—Ç–æ–ª–∏ –∑ –Ω–æ–º–µ—Ä–∞–º–∏ 1, 2, 3...

### –ö—Ä–æ–∫ 5: –î–æ–¥–∞—î –∑–≤–∏—á–∞–π–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
- –î–æ–¥–∞—î `INDEX idx_number (number)` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É

---

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏:

```sql
USE bar_kitchen_pos;

SELECT 
    INDEX_NAME,
    GROUP_CONCAT(COLUMN_NAME ORDER BY SEQ_IN_INDEX) as COLUMNS,
    CASE WHEN NON_UNIQUE = 0 THEN 'UNIQUE' ELSE 'NON-UNIQUE' END as TYPE
FROM INFORMATION_SCHEMA.STATISTICS
WHERE TABLE_SCHEMA = 'bar_kitchen_pos'
    AND TABLE_NAME = 'tables'
    AND (COLUMN_NAME = 'number' OR COLUMN_NAME = 'client_id')
GROUP BY INDEX_NAME, NON_UNIQUE
ORDER BY INDEX_NAME;
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `idx_number_client` - **UNIQUE** –Ω–∞ `(number, client_id)` ‚úÖ
- `idx_number` - NON-UNIQUE –Ω–∞ `number` ‚úÖ
- `idx_client_id` - NON-UNIQUE –Ω–∞ `client_id` ‚úÖ

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–∞–Ω—ñ:

```sql
USE bar_kitchen_pos;

SELECT id, number, client_id FROM tables ORDER BY client_id, number;
```

**–ü—Ä–∏–∫–ª–∞–¥ (–∫–æ—Ä–µ–∫—Ç–Ω–æ):**
```
+----+--------+-----------+
| id | number | client_id |
+----+--------+-----------+
|  1 |      1 |         1 |  <- –ö–ª—ñ—î–Ω—Ç 1, —Å—Ç—ñ–ª 1
|  2 |      2 |         1 |  <- –ö–ª—ñ—î–Ω—Ç 1, —Å—Ç—ñ–ª 2
|  3 |      1 |         2 |  <- –ö–ª—ñ—î–Ω—Ç 2, —Å—Ç—ñ–ª 1 ‚úÖ (–º–æ–∂–Ω–∞!)
|  4 |      2 |         2 |  <- –ö–ª—ñ—î–Ω—Ç 2, —Å—Ç—ñ–ª 2 ‚úÖ (–º–æ–∂–Ω–∞!)
+----+--------+-----------+
```

---

## üöÄ –ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è SQL:

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ):

```powershell
cd D:\Work\Pizza\backend
npm run dev
```

### 2. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∏ —Å—Ç—ñ–ª:

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
2. –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≤–∫–ª–∞–¥–∫–∏ "–°—Ç–æ–ª–∏"
3. –î–æ–¥–∞—Ç–∏ —Å—Ç—ñ–ª –∑ –Ω–æ–º–µ—Ä–æ–º, —è–∫–∏–π –≤–∂–µ —ñ—Å–Ω—É—î –¥–ª—è —ñ–Ω—à–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
4. –ú–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ ‚úÖ

---

## ‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- ‚úÖ –ö–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ –º–∞—Ç–∏ —Å—Ç–æ–ª–∏ –∑ –Ω–æ–º–µ—Ä–∞–º–∏ 1, 2, 3...
- ‚úÖ –ö–ª—ñ—î–Ω—Ç 1 –º–æ–∂–µ –º–∞—Ç–∏ —Å—Ç—ñ–ª ‚Ññ1
- ‚úÖ –ö–ª—ñ—î–Ω—Ç 2 —Ç–µ–∂ –º–æ–∂–µ –º–∞—Ç–∏ —Å—Ç—ñ–ª ‚Ññ1 (–±–µ–∑ –ø–æ–º–∏–ª–æ–∫!)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å —Ç—ñ–ª—å–∫–∏ –≤ –º–µ–∂–∞—Ö –æ–¥–Ω–æ–≥–æ `client_id`

---

## üí° –ü–æ—è—Å–Ω–µ–Ω–Ω—è:

**–î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –Ü—Å–Ω—É–≤–∞–≤ `UNIQUE INDEX number` ‚Üí –æ–¥–∏–Ω –Ω–æ–º–µ—Ä —Å—Ç–æ–ª—É –¥–ª—è –≤—Å—ñ—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤
- –ö–ª—ñ—î–Ω—Ç 2 –Ω–µ –º—ñ–≥ –¥–æ–¥–∞—Ç–∏ —Å—Ç—ñ–ª ‚Ññ1, —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É–≤–∞–≤ —É –∫–ª—ñ—î–Ω—Ç–∞ 1

**–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
- –Ü—Å–Ω—É—î `UNIQUE INDEX idx_number_client (number, client_id)` ‚Üí –æ–¥–∏–Ω –Ω–æ–º–µ—Ä —Å—Ç–æ–ª—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
- –ö–æ–∂–µ–Ω –∫–ª—ñ—î–Ω—Ç –º–∞—î —Å–≤–æ—é —ñ–∑–æ–ª—å–æ–≤–∞–Ω—É –±–∞–∑—É —Å—Ç–æ–ª—ñ–≤
- –ö–ª—ñ—î–Ω—Ç 2 –º–æ–∂–µ –º–∞—Ç–∏ —Å—Ç—ñ–ª ‚Ññ1, —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î —É –∫–ª—ñ—î–Ω—Ç–∞ 2

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ:** `fix-unique-index-tables.sql` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —ñ–Ω–¥–µ–∫—Å—É —Å—Ç–æ–ª—ñ–≤.


