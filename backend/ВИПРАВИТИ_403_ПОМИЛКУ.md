# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–∫–∏ 403 (Forbidden)

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞:

```
GET http://localhost:3001/api/products 403 (Forbidden)
GET http://localhost:3001/api/tables 403 (Forbidden)
GET http://localhost:3001/api/orders 403 (Forbidden)
```

**–ü—Ä–∏—á–∏–Ω–∞:** JWT —Ç–æ–∫–µ–Ω –Ω–µ –º—ñ—Å—Ç–∏—Ç—å `client_id` –∞–±–æ –≤ –ë–î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –º–∞—î `client_id`.

---

## ‚úÖ –†–Ü–®–ï–ù–ù–Ø (–≤–∏–±–µ—Ä—ñ—Ç—å –æ–¥–∏–Ω –∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤):

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ë–î (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

1. **–í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç:**
   ```powershell
   cd D:\Work\Pizza\backend
   mysql -u root -p < add-multi-tenancy.sql
   ```

2. **–ú—ñ–≥—Ä—É–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:**
   ```powershell
   npm run migrate:users
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend:**
   ```powershell
   npm run dev
   ```

4. **–ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º—ñ** (—â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤–∏–π JWT —Ç–æ–∫–µ–Ω –∑ `client_id`)

---

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –®–≤–∏–¥–∫–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è (—è–∫—â–æ SQL —Å–∫—Ä–∏–ø—Ç –≤–∂–µ –≤–∏–∫–æ–Ω–∞–Ω–æ)

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –º—ñ–≥—Ä–∞—Ü—ñ—ó:**
   ```powershell
   cd D:\Work\Pizza\backend
   npm run migrate:users
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend:**
   ```powershell
   npm run dev
   ```

3. **–ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º—ñ**

---

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –†—É—á–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ MySQL

```sql
-- 1. –í–∏–∫–æ–Ω–∞—Ç–∏ SQL —Å–∫—Ä–∏–ø—Ç add-multi-tenancy.sql

-- 2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞ –¥–ª—è —ñ—Å–Ω—É—é—á–æ–≥–æ –∞–¥–º—ñ–Ω–∞
INSERT INTO clients (name, email, status) 
VALUES ('–í–∞—à —Ä–µ—Å—Ç–æ—Ä–∞–Ω', 'admin@pizza.com', 'active');

-- 3. –û—Ç—Ä–∏–º–∞—Ç–∏ ID —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
SELECT id FROM clients WHERE email = 'admin@pizza.com';

-- 4. –û–Ω–æ–≤–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ client_id (–∑–∞–º—ñ–Ω—ñ—Ç—å CLIENT_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π ID)
UPDATE users SET client_id = CLIENT_ID WHERE email = 'admin@pizza.com';

-- 5. –û–Ω–æ–≤–∏—Ç–∏ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ —Ä–æ–ª—è–º–∏
UPDATE users SET client_id = CLIENT_ID WHERE role IN ('kitchen', 'bar', 'cashier');
```

---

## üîç –ü–ï–†–ï–í–Ü–†–ö–ê:

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î client_id –≤ –ë–î:

```sql
SELECT id, email, role, client_id FROM users;
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î –∫–ª—ñ—î–Ω—Ç–∏:

```sql
SELECT * FROM clients;
```

### 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—å:

```sql
DESCRIBE users;
DESCRIBE products;
DESCRIBE tables;
DESCRIBE orders;
```

–£ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –∫–æ–ª–æ–Ω–∫–∞ `client_id`.

---

## üìù –©–û –ë–£–õ–û –í–ò–ü–†–ê–í–õ–ï–ù–û:

1. ‚úÖ `getClientId()` —Ç–µ–ø–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î `client_id` –∑ –ë–î, —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î –≤ JWT
2. ‚úÖ –í—Å—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `await getClientId(req)`
3. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç –º—ñ–≥—Ä–∞—Ü—ñ—ó `migrate-existing-users.js`
4. ‚úÖ –î–æ–¥–∞–Ω–æ –∫–æ–º–∞–Ω–¥—É `npm run migrate:users` –≤ package.json

---

## üöÄ –ü–Ü–°–õ–Ø –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø:

1. –í–∏–∫–æ–Ω–∞–π—Ç–µ –æ–¥–∏–Ω –∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –≤–∏—â–µ
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å backend
3. –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω—å—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º—ñ
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ —Å—Ç–æ–ª–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è

---

## üí° –ü–†–ò–ú–Ü–¢–ö–ê:

–Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ 403 –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç—ñ–≤:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ SQL —Å–∫—Ä–∏–ø—Ç `add-multi-tenancy.sql`
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î `client_id` –≤ –ë–î
3. –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω—å—Ç–µ—Å—å –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ JWT —Ç–æ–∫–µ–Ω—É –∑ `client_id`
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫


