# ‚ö° –®–í–ò–î–ö–ò–ô –§–Ü–ö–° - –î–æ–¥–∞—Ç–∏ client_id –≤ users

## üìã –Ø–∫—â–æ –≤–∏ –≤–∂–µ –≤–∏–∫–æ–Ω—É—î—Ç–µ SQL –≤—Ä—É—á–Ω—É:

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –≥–æ—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```powershell
cd D:\Work\Pizza\backend

# –í–∏–∫–æ–Ω–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç, —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
Get-Content fix-users-client-id.sql | mysql -u root -p bar_kitchen_pos
```

---

## üìù –Ø–∫—â–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ –≤—Ä—É—á–Ω—É –≤ MySQL:

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—î —Ç–∞–±–ª–∏—Ü—è clients

```sql
USE bar_kitchen_pos;
SHOW TABLES LIKE 'clients';
```

**–Ø–∫—â–æ —Ç–∞–±–ª–∏—Ü—è –ù–ï —ñ—Å–Ω—É—î** - —Å–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä–∏—Ç–∏:

```sql
CREATE TABLE IF NOT EXISTS clients (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    phone VARCHAR(20) NULL,
    address TEXT NULL,
    status ENUM('active', 'suspended', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—î –∫–æ–ª–æ–Ω–∫–∞ client_id

```sql
DESCRIBE users;
```

**–Ø–∫—â–æ –∫–æ–ª–æ–Ω–∫–∏ `client_id` –ù–ï —ñ—Å–Ω—É—î** - –¥–æ–¥–∞—Ç–∏:

```sql
ALTER TABLE users 
ADD COLUMN client_id INT NULL AFTER id;
```

### –ö—Ä–æ–∫ 3: –î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å

```sql
ALTER TABLE users 
ADD INDEX idx_client_id (client_id);
```

### –ö—Ä–æ–∫ 4: –î–æ–¥–∞—Ç–∏ foreign key (–í–ê–ñ–õ–ò–í–û: —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è clients!)

```sql
ALTER TABLE users 
ADD FOREIGN KEY (client_id) REFERENCES clients(id) ON DELETE CASCADE;
```

---

## ‚ö†Ô∏è –Ø–ö–©–û –ü–û–ú–ò–õ–ö–ê:

### –ü–æ–º–∏–ª–∫–∞: "Table 'clients' doesn't exist"

**–†—ñ—à–µ–Ω–Ω—è:** –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é `clients` (–¥–∏–≤. –ö—Ä–æ–∫ 1 –≤–∏—â–µ).

### –ü–æ–º–∏–ª–∫–∞: "Duplicate column name 'client_id'"

**–†—ñ—à–µ–Ω–Ω—è:** –ö–æ–ª–æ–Ω–∫–∞ –≤–∂–µ —ñ—Å–Ω—É—î, –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ö—Ä–æ–∫ 2.

### –ü–æ–º–∏–ª–∫–∞: "Duplicate key name 'idx_client_id'"

**–†—ñ—à–µ–Ω–Ω—è:** –Ü–Ω–¥–µ–∫—Å –≤–∂–µ —ñ—Å–Ω—É—î, –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ö—Ä–æ–∫ 3.

### –ü–æ–º–∏–ª–∫–∞: "Duplicate foreign key constraint name"

**–†—ñ—à–µ–Ω–Ω—è:** Foreign key –≤–∂–µ —ñ—Å–Ω—É—î, –º–æ–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ö—Ä–æ–∫ 4.

---

## ‚úÖ –ü–ï–†–ï–í–Ü–†–ö–ê:

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É users:

```sql
DESCRIBE users;
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
+-----------+---------+------+-----+---------+----------------+
| Field     | Type    | Null | Key | Default | Extra          |
+-----------+---------+------+-----+---------+----------------+
| id        | int     | NO   | PRI | NULL    | auto_increment |
| client_id | int     | YES  | MUL | NULL    |                |  <- –¶—è –∫–æ–ª–æ–Ω–∫–∞
| email     | varchar | NO   | UNI | NULL    |                |
| password  | varchar | NO   |     | NULL    |                |
| role      | enum    | NO   | MUL | NULL    |                |
| ...       | ...     | ...  | ... | ...     | ...            |
+-----------+---------+------+-----+---------+----------------+
```

---

## üöÄ –ü–Ü–°–õ–Ø –î–û–î–ê–í–ê–ù–ù–Ø client_id:

```powershell
# 1. –ú—ñ–≥—Ä—É–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
npm run migrate:users

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ backend
npm run dev

# 3. –ü–µ—Ä–µ–ª–æ–≥—ñ–Ω–∏—Ç–∏—Å—å –≤ —Å–∏—Å—Ç–µ–º—ñ
```

---

## üí° –®–í–ò–î–ö–ê –ö–û–ú–ê–ù–î–ê (–≤—Å–µ –≤ –æ–¥–Ω–æ–º—É):

```powershell
Get-Content fix-users-client-id.sql | mysql -u root -p bar_kitchen_pos
```

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å —á–∏ —ñ—Å–Ω—É—î —Ç–∞–±–ª–∏—Ü—è `clients` (—Å—Ç–≤–æ—Ä–∏—Ç—å —è–∫—â–æ –Ω–µ–º–∞—î)
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å —á–∏ —ñ—Å–Ω—É—î –∫–æ–ª–æ–Ω–∫–∞ `client_id` (–¥–æ–¥–∞—Å—Ç—å —è–∫—â–æ –Ω–µ–º–∞—î)
- ‚úÖ –î–æ–¥–∞—Å—Ç—å —ñ–Ω–¥–µ–∫—Å —Ç–∞ foreign key —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —ó—Ö –Ω–µ–º–∞—î
- ‚úÖ –ü–æ–∫–∞–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ñ `users`

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ —Ñ–∞–π–ª:** `fix-users-client-id.sql` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.


